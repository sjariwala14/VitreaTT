<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vitrea Troubleshooting Mind Map</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --text-color: #333;
            --bg-color: #f5f5f5;
            --card-bg: #fff;
            --border-radius: 8px;
            --box-shadow: 0 0 10px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        h1 {
            color: var(--dark-color);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .search-container {
            flex: 1;
            min-width: 250px;
        }
        
        #search {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
        }
        
        #search:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            background-color: var(--light-color);
            color: var(--dark-color);
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            font-weight: 500;
        }
        
        .filter-btn:hover {
            background-color: #d5dbdb;
        }
        
        .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .favorites-btn {
            background-color: var(--warning-color);
            color: white;
        }
        
        .breadcrumbs {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .breadcrumb {
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .breadcrumb:hover {
            text-decoration: underline;
        }
        
        .breadcrumb-separator {
            margin: 0 8px;
            color: #95a5a6;
        }
        
        .mindmap-container {
            display: flex;
            gap: 20px;
        }
        
        .mindmap-nav {
            width: 300px;
            flex-shrink: 0;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 15px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .mindmap {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .node {
            margin: 3px 0;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            background-color: var(--light-color);
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .node:hover {
            background-color: #d4e6f1;
            transform: translateX(5px);
        }
        
        .node.active {
            background-color: var(--primary-color);
            color: white;
            border-left-color: var(--secondary-color);
        }
        
        .node-favorite {
            color: var(--warning-color);
            margin-left: 10px;
            cursor: pointer;
        }
        
        .node-favorite.active {
            color: var(--warning-color);
        }
        
        .deployment-badge {
            display: inline-block;
            padding: 2px 8px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .content-container {
            flex: 1;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            min-height: 600px;
        }
        
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        
        .content-title {
            margin: 0;
            color: var(--dark-color);
            font-size: 24px;
        }
        
        .content-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: var(--border-radius);
            background-color: var(--light-color);
            color: var(--dark-color);
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .action-btn:hover {
            background-color: #d5dbdb;
        }
        
        .action-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .content-section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 18px;
            color: var(--dark-color);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .section-title:hover {
            color: var(--primary-color);
        }
        
        .section-title::before {
            content: 'â–¶';
            font-size: 12px;
            margin-right: 10px;
            transition: var(--transition);
        }
        
        .section-title.expanded::before {
            transform: rotate(90deg);
        }
        
        .section-content {
            padding-left: 20px;
            margin-top: 10px;
            display: none;
        }
        
        .section-content.expanded {
            display: block;
        }
        
        .subsection {
            margin-bottom: 15px;
        }
        
        .subsection-title {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 5px;
        }
        
        ul, ol {
            margin-top: 5px;
            margin-bottom: 5px;
            padding-left: 20px;
        }
        
        li {
            margin-bottom: 5px;
        }
        
        .highlight {
            background-color: #fffacd;
            padding: 0 2px;
            border-radius: 3px;
        }
        
        .no-results {
            text-align: center;
            padding: 20px;
            color: #95a5a6;
            font-style: italic;
        }
        
        .favorite-star {
            color: #ccc;
            cursor: pointer;
            transition: var(--transition);
            font-size: 20px;
        }
        
        .favorite-star.active {
            color: var(--warning-color);
        }
        
        @media (max-width: 768px) {
            .mindmap-container {
                flex-direction: column;
            }
            
            .mindmap-nav {
                width: 100%;
                max-height: 300px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-buttons {
                justify-content: center;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-map"></i> Vitrea Troubleshooting Mind Map</h1>
        
        <div class="controls">
            <div class="search-container">
                <input type="text" id="search" placeholder="Search for issues, symptoms, or solutions...">
            </div>
            
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="enterprise">Enterprise</button>
                <button class="filter-btn" data-filter="workstation">Workstation</button>
                <button class="filter-btn" data-filter="extend">Extend</button>
                <button class="filter-btn favorites-btn" data-filter="favorites">
                    <i class="fas fa-star"></i> Favorites
                </button>
            </div>
        </div>
        
        <div class="breadcrumbs" id="breadcrumbs">
            <span class="breadcrumb" data-level="0">All Issues</span>
        </div>
        
        <div class="mindmap-container">
            <div class="mindmap-nav">
                <div id="mindmap" class="mindmap">
                    <!-- Mind map will be generated here by JavaScript -->
                </div>
            </div>
            
            <div class="content-container" id="content-container">
                <div id="welcome-message">
                    <h2>Welcome to Vitrea Troubleshooting Guide</h2>
                    <p>Select an issue from the left panel to view detailed troubleshooting information.</p>
                    <p>You can:</p>
                    <ul>
                        <li>Search for specific issues using the search box</li>
                        <li>Filter by deployment type (Enterprise, Workstation, Extend)</li>
                        <li>Mark issues as favorites for quick access</li>
                        <li>Click on any issue to see detailed troubleshooting steps</li>
                    </ul>
                    <div style="margin-top: 30px; background-color: #f8f9fa; padding: 15px; border-radius: 5px;">
                        <h3><i class="fas fa-lightbulb"></i> Quick Tips</h3>
                        <ul>
                            <li>Use the breadcrumbs above to navigate back to previous levels</li>
                            <li>Click section headers to expand/collapse content</li>
                            <li>Star icon (<i class="fas fa-star" style="color: var(--warning-color)"></i>) marks favorites</li>
                        </ul>
                    </div>
                </div>
                
                <div id="content" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title" id="content-title"></h2>
                        <div class="content-actions">
                            <button class="action-btn" id="print-btn">
                                <i class="fas fa-print"></i> Print
                            </button>
                            <button class="action-btn primary" id="favorite-btn">
                                <i class="far fa-star"></i> Favorite
                            </button>
                        </div>
                    </div>
                    
                    <div id="content-body">
                        <!-- Content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data structure for the mind map
        const troubleshootingData = {
            "All Sessions are in use": {
                "Symptom": "An 'All Sessions are in use, another user must disconnect before you can connect:' error screen is displayed on an Application Server.",
                "Deployment": "Enterprise deployment (Application Server only)",
                "Resolution": [
                    "Click Exit to close the error screen.",
                    "Connect to the Application Server.",
                    "If the error screen displays, disconnect a user by accessing Server Manager > Remote Desktop Services screen, expanding Collections in the left pane, and then in the Connections section, right-clicking the desired user and selecting Logoff."
                ]
            },
            "Applications are not launching": {
                "Symptom": "An application fails to start when attempting to launch it from the StudyList or Application Selector.",
                "Deployment": "Enterprise, Enterprise Single Server, and Vitrea extend deployments",
                "Potential Causes": [
                    "Licensing issues",
                    "The application failing to get required resources to start",
                    "An application error"
                ],
                "Specific Errors": {
                    "Application name (process id #) terminated abnormally": {
                        "Action": "Collect the corresponding application's logfile and any exception information, note the time, and any information on how to reproduce the issue."
                    },
                    "Vitrea Client has encountered an error and cannot retrieve required study information": {
                        "Action": "Collect log information for the AppShell and SessionHelper."
                    },
                    "Unable to acquire system resources to launch this application": {
                        "Action": [
                            "Ensure the correct NVIDIA driver is installed.",
                            "Ensure other user sessions have closed all desktop applications (and logged out, if applicable)."
                        ]
                    },
                    "Cedars Applications (QBS, QGS/QPS) error dialog": {
                        "Action": "Review the license installation."
                    }
                },
                "Licensing": {
                    "Action": "Confirm the feature is purchased and available using the licensing admin page and the 'in-use' licensing URL: http://localhost:8700/management/api/license/usage.",
                    "Note": "When accessing Vitrea Applications and administration screens, only use the Vitrea Client or Remote Desktop to the Enterprise Single Server, Management Server, or Vitrea Extend system."
                }
            },
            "Applications are unable to load data": {
                "Symptom": "Unable to launch/load data into clinical applications, or unable to create snapshots or evidence.",
                "Deployment": "Enterprise, Vitrea extend, and Vitrea workstation deployments",
                "Solutions": [
                    "Verify and correct your NASROOT permissions (the Management Server must be shared with R/W permissions).",
                    "Verify and correct your NASROOT permission Groups, ensuring your domain group (with your user account) has R/W permissions."
                ]
            },
            "AppShell Timeout error displays": {
                "Symptom": "Launching the thin client produces a timeout error dialog.",
                "Deployment": "Enterprise and Vitrea extend deployments",
                "Tips": "Check group policies for Vitrea Kiosk launch on connection.",
                "Solution": "Apply the group policy and re-login."
            },
            "Cannot import study using Media Manager": {
                "Deployment": "Enterprise deployment (Management Server, Application Server, and Multi Modality Viewer Server)",
                "Tips": "Check the AE Title and port in the Media Manager Config."
            },
            "Cannot launch Vitrea on a client system using a non-administrator user": {
                "Deployment": "Enterprise Single Server and Vitrea extend deployments",
                "Resolution Steps": [
                    "Log onto the client machine as an administrator.",
                    "Open regedit.",
                    "Delete the HKLM\\SOFTWARE\\Microsoft\\MSLicensing registry key.",
                    "Delete the HKLM\\SOFTWARE\\Wow6432Node\\Microsoft\\MSLicensing registry key.",
                    "Reboot the client machine.",
                    "Log onto the client machine as an administrator and open MSTSC.exe as an administrator.",
                    "Connect to the Vitrea extend host system.",
                    "Reboot the client machine.",
                    "Log onto the client machine as a standard user.",
                    "Run Vitrea client as an administrator and enter admin credentials.",
                    "Exit the Vitrea software.",
                    "Run Vitrea client as a standard user."
                ]
            },
            "Collecting Performance Logs": {
                "Deployment": "Enterprise, Enterprise Single Server, Vitrea extend, and Vitrea workstation deployments",
                "Steps": [
                    "Log into the Vitrea software.",
                    "From the Applications Home screen, click the gear icon in the upper right corner to access a dropdown menu.",
                    "Select the Collect Performance Logs option.",
                    "Type the desired issue description in the field below the 'Describe your issue' heading.",
                    "(Optional) Click the button to take a screenshot of the active screen.",
                    "Click the Save button after entering the description and including a screenshot."
                ],
                "Result": "The system collects environment information and saves logs (and screenshots) to C:\\NAS\\logCollection\\current\\{year}/{month}\\{date-guid} folder."
            },
            "CONFIG REQUIRED button displays on install screen during installation": {
                "Symptom": "The 'CONFIG REQUIRED' button is displayed during installation.",
                "Deployment": "Enterprise, Enterprise Single Server, Vitrea extend, and Vitrea workstation deployments",
                "Cause": "The 'Run the System Setup Script' procedure for Windows 7 has not been completed.",
                "Action": "Complete the 'Run the System Setup Script' procedure for Windows 7 before continuing installation."
            },
            "Connection credentials already in use": {
                "Symptom": "Receiving this message on a Vitrea Thin Client.",
                "Deployment": "Enterprise, Enterprise Single Server, and Vitrea Extend deployments",
                "Cause": "Your credentials are already connected to the collection (Enterprise) or system (Enterprise Single Server or Vitrea Extend). Multiple logins by the same user are not supported.",
                "Resolution Steps": [
                    "Log off the other session shown in the message screen.",
                    "Try to connect again.",
                    "For Enterprise deployment: If you can select a different collection, connecting to that one may work."
                ]
            }
        };

        // Favorites system
        let favorites = JSON.parse(localStorage.getItem('vitreaFavorites')) || [];
        
        // Current state
        let currentIssue = null;
        let currentFilter = 'all';
        let currentSearchTerm = '';
        
        // Function to create the mind map
        function createMindMap() {
            const mindmapElement = document.getElementById('mindmap');
            mindmapElement.innerHTML = '';
            
            let issuesToShow = Object.keys(troubleshootingData);
            
            // Apply search filter
            if (currentSearchTerm.trim() !== '') {
                issuesToShow = issuesToShow.filter(issue => 
                    issue.toLowerCase().includes(currentSearchTerm.toLowerCase()) ||
                    JSON.stringify(troubleshootingData[issue]).toLowerCase().includes(currentSearchTerm.toLowerCase())
                );
            }
            
            // Apply deployment filter
            if (currentFilter !== 'all' && currentFilter !== 'favorites') {
                issuesToShow = issuesToShow.filter(issue => {
                    const deployment = troubleshootingData[issue].Deployment || '';
                    return deployment.toLowerCase().includes(currentFilter.toLowerCase());
                });
            }
            
            // Apply favorites filter
            if (currentFilter === 'favorites') {
                issuesToShow = issuesToShow.filter(issue => favorites.includes(issue));
            }
            
            if (issuesToShow.length === 0) {
                mindmapElement.innerHTML = '<div class="no-results">No issues found matching your criteria</div>';
                return;
            }
            
            issuesToShow.forEach(issue => {
                const node = document.createElement('div');
                node.className = `node ${currentIssue === issue ? 'active' : ''}`;
                
                const nodeText = document.createElement('span');
                nodeText.textContent = issue;
                node.appendChild(nodeText);
                
                // Add deployment badge if available
                if (troubleshootingData[issue].Deployment) {
                    const deploymentBadge = document.createElement('span');
                    deploymentBadge.className = 'deployment-badge';
                    deploymentBadge.textContent = troubleshootingData[issue].Deployment;
                    node.appendChild(deploymentBadge);
                }
                
                // Add favorite star
                const favoriteStar = document.createElement('span');
                favoriteStar.className = `node-favorite ${favorites.includes(issue) ? 'active' : ''}`;
                favoriteStar.innerHTML = favorites.includes(issue) ? '<i class="fas fa-star"></i>' : '<i class="far fa-star"></i>';
                favoriteStar.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleFavorite(issue);
                });
                node.appendChild(favoriteStar);
                
                node.addEventListener('click', function(e) {
                    if (!e.target.classList.contains('node-favorite')) {
                        showContent(issue);
                    }
                });
                
                mindmapElement.appendChild(node);
            });
        }

        // Function to show content for a selected issue
        function showContent(issue) {
            currentIssue = issue;
            const content = troubleshootingData[issue];
            const contentTitle = document.getElementById('content-title');
            const contentBody = document.getElementById('content-body');
            const contentElement = document.getElementById('content');
            const welcomeMessage = document.getElementById('welcome-message');
            const favoriteBtn = document.getElementById('favorite-btn');
            
            // Update breadcrumbs
            updateBreadcrumbs(issue);
            
            // Hide welcome message and show content
            welcomeMessage.style.display = 'none';
            contentElement.style.display = 'block';
            
            // Update favorite button
            favoriteBtn.innerHTML = favorites.includes(issue) ? 
                '<i class="fas fa-star"></i> Favorited' : 
                '<i class="far fa-star"></i> Favorite';
            
            // Set title
            contentTitle.textContent = issue;
            
            // Build content body
            contentBody.innerHTML = '';
            
            // Add deployment information if available
            if (content.Deployment) {
                const section = createContentSection('Deployment', content.Deployment);
                contentBody.appendChild(section);
            }
            
            // Add symptom if available
            if (content.Symptom) {
                const section = createContentSection('Symptom', content.Symptom);
                contentBody.appendChild(section);
            }
            
            // Add other content
            for (const key in content) {
                if (key !== 'Deployment' && key !== 'Symptom') {
                    const section = createContentSection(key, content[key]);
                    contentBody.appendChild(section);
                }
            }
            
            // Highlight search terms in content
            if (currentSearchTerm.trim() !== '') {
                highlightSearchTerms(contentBody);
            }
            
            // Update active node in mindmap
            createMindMap();
        }

        // Create a content section with expand/collapse functionality
        function createContentSection(title, content) {
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'content-section';
            
            const sectionTitle = document.createElement('h3');
            sectionTitle.className = 'section-title';
            sectionTitle.textContent = title;
            sectionTitle.addEventListener('click', function() {
                this.classList.toggle('expanded');
                const content = this.nextElementSibling;
                content.classList.toggle('expanded');
            });
            
            const sectionContent = document.createElement('div');
            sectionContent.className = 'section-content';
            
            if (Array.isArray(content)) {
                // For arrays, create a list
                const list = document.createElement('ul');
                content.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    sectionContent.appendChild(li);
                });
            } else if (typeof content === 'object') {
                // For objects, create nested structure
                for (const subKey in content) {
                    const subSection = document.createElement('div');
                    subSection.className = 'subsection';
                    
                    const subTitle = document.createElement('div');
                    subTitle.className = 'subsection-title';
                    subTitle.textContent = subKey;
                    
                    const subContent = document.createElement('div');
                    
                    if (Array.isArray(content[subKey])) {
                        const subList = document.createElement('ul');
                        content[subKey].forEach(item => {
                            const li = document.createElement('li');
                            li.textContent = item;
                            subList.appendChild(li);
                        });
                        subContent.appendChild(subList);
                    } else if (typeof content[subKey] === 'object') {
                        // Handle deeper nesting if needed
                        subContent.textContent = JSON.stringify(content[subKey]);
                    } else {
                        subContent.textContent = content[subKey];
                    }
                    
                    subSection.appendChild(subTitle);
                    subSection.appendChild(subContent);
                    sectionContent.appendChild(subSection);
                }
            } else {
                // For simple values
                sectionContent.textContent = content;
            }
            
            sectionDiv.appendChild(sectionTitle);
            sectionDiv.appendChild(sectionContent);
            
            // Expand the first few sections by default
            if (['Resolution', 'Solution', 'Steps', 'Action'].includes(title)) {
                sectionTitle.classList.add('expanded');
                sectionContent.classList.add('expanded');
            }
            
            return sectionDiv;
        }

        // Update breadcrumbs
        function updateBreadcrumbs(issue) {
            const breadcrumbsElement = document.getElementById('breadcrumbs');
            breadcrumbsElement.innerHTML = '';
            
            const allIssuesCrumb = document.createElement('span');
            allIssuesCrumb.className = 'breadcrumb';
            allIssuesCrumb.textContent = 'All Issues';
            allIssuesCrumb.addEventListener('click', function() {
                currentIssue = null;
                document.getElementById('welcome-message').style.display = 'block';
                document.getElementById('content').style.display = 'none';
                createMindMap();
            });
            breadcrumbsElement.appendChild(allIssuesCrumb);
            
            if (issue) {
                const separator = document.createElement('span');
                separator.className = 'breadcrumb-separator';
                separator.innerHTML = '&raquo;';
                breadcrumbsElement.appendChild(separator);
                
                const issueCrumb = document.createElement('span');
                issueCrumb.className = 'breadcrumb';
                issueCrumb.textContent = issue;
                breadcrumbsElement.appendChild(issueCrumb);
            }
        }

        // Toggle favorite status
        function toggleFavorite(issue) {
            const index = favorites.indexOf(issue);
            if (index === -1) {
                favorites.push(issue);
            } else {
                favorites.splice(index, 1);
            }
            localStorage.setItem('vitreaFavorites', JSON.stringify(favorites));
            createMindMap();
            
            // Update favorite button if this is the current issue
            if (currentIssue === issue) {
                const favoriteBtn = document.getElementById('favorite-btn');
                favoriteBtn.innerHTML = favorites.includes(issue) ? 
                    '<i class="fas fa-star"></i> Favorited' : 
                    '<i class="far fa-star"></i> Favorite';
            }
        }

        // Highlight search terms in content
        function highlightSearchTerms(element) {
            const searchTerm = currentSearchTerm.toLowerCase();
            if (!searchTerm.trim()) return;
            
            const regex = new RegExp(searchTerm, 'gi');
            
            function highlightTextNodes(node) {
                if (node.nodeType === Node.TEXT_NODE) {
                    const text = node.nodeValue;
                    if (text.toLowerCase().includes(searchTerm)) {
                        const span = document.createElement('span');
                        span.innerHTML = text.replace(regex, match => 
                            `<span class="highlight">${match}</span>`
                        );
                        node.parentNode.replaceChild(span, node);
                    }
                } else if (node.nodeType === Node.ELEMENT_NODE && 
                          !['SCRIPT', 'STYLE', 'TEXTAREA', 'INPUT'].includes(node.tagName)) {
                    Array.from(node.childNodes).forEach(highlightTextNodes);
                }
            }
            
            highlightTextNodes(element);
        }

        // Initialize the mind map
        createMindMap();
        
        // Search functionality
        document.getElementById('search').addEventListener('input', function() {
            currentSearchTerm = this.value;
            createMindMap();
            
            // Highlight in content if content is shown
            if (currentIssue) {
                const contentBody = document.getElementById('content-body');
                highlightSearchTerms(contentBody);
            }
        });
        
        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentFilter = this.dataset.filter;
                createMindMap();
            });
        });
        
        // Favorite button
        document.getElementById('favorite-btn').addEventListener('click', function() {
            if (currentIssue) {
                toggleFavorite(currentIssue);
            }
        });
        
        // Print button
        document.getElementById('print-btn').addEventListener('click', function() {
            window.print();
        });
        
        // Expand all sections button
        document.addEventListener('keydown', function(e) {
            // Ctrl+E to expand all sections
            if (e.ctrlKey && e.key === 'e') {
                document.querySelectorAll('.section-title').forEach(title => {
                    if (!title.classList.contains('expanded')) {
                        title.classList.add('expanded');
                        title.nextElementSibling.classList.add('expanded');
                    }
                });
                e.preventDefault();
            }
            // Ctrl+C to collapse all sections
            else if (e.ctrlKey && e.key === 'c') {
                document.querySelectorAll('.section-title').forEach(title => {
                    if (title.classList.contains('expanded')) {
                        title.classList.remove('expanded');
                        title.nextElementSibling.classList.remove('expanded');
                    }
                });
                e.preventDefault();
            }
        });
    </script>
</body>
</html>